{{ define "main" }}
    <h1>{{ if eq .RelPermalink "/" }}{{ .Site.Title }}{{ else }}{{ .Title }}{{ end }}</h1>
    
    {{ partial "categories.html" . }}
    
    {{ $pages := where site.RegularPages "Type" "posts" }}
    {{ if ne .RelPermalink "/" }}
        {{ if eq .RelPermalink "/posts/" }}
            {{ $pages = where .Site.RegularPages "Section" "posts" }}
        {{ else }}
            {{ $pages = .Pages }}
        {{ end }}
    {{ end }}
    
    {{ range $pages.GroupByDate "2006" }}
    <section class="posts-year">
        <h2>{{ .Key }}</h2>
        
        {{ range .Pages }}
        <article class="post-item">
            <div class="post-date">{{ .Date.Format "Jan 2" }}</div>
            <div class="post-content">
                <div class="post-header-line">
                    <span class="post-category">
                        {{ if .Params.categories }}
                            {{ with index .Params.categories 0 }}{{ . }}{{ end }}
                        {{ else }}
                            Uncategorized
                        {{ end }}
                    </span>
                    <a href="{{ .Permalink }}" class="post-title">{{ .Title }}</a>
                </div>
                <div class="post-summary">
                    {{ if .Params.summary }}
                        {{ .Params.summary }}
                    {{ end }}
                </div>
            </div>
        </article>
        {{ end }}
    </section>
    {{ end }}
{{ end }}
